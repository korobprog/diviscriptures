# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ —Å—Ç–∏—Ö–æ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–∏–ª, —á—Ç–æ–±—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Å—Ç–∏—Ö–æ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ "1.16-18" –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç–∏—Ö–æ–≤.

## –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å `Verse` –≤ `prisma/schema.prisma`:
```prisma
isMergedVerse  Boolean  @default(false) // Is this verse part of a merged block
mergedWith     String?  // JSON array of verse numbers in the merged block (e.g., "[16,17,18]")
mergedBlockId  String?  // Unique identifier for the merged block
```

–°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `20250919000000_add_merged_verse_fields`.

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Python –ø–∞—Ä—Å–µ—Ä–∞
- –û–±–Ω–æ–≤–ª–µ–Ω `database.py` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∞—Ö
- –û–±–Ω–æ–≤–ª–µ–Ω `bhagavad_gita_parser.py` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID –±–ª–æ–∫–æ–≤
- –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–∞—Ä—Å–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç–∏—Ö–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API
–û–±–Ω–æ–≤–ª–µ–Ω `/app/api/verses/get/route.ts` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π:
```typescript
isMergedVerse: verse.isMergedVerse || false,
mergedWith: verse.mergedWith ? JSON.parse(verse.mergedWith) : null,
mergedBlockId: verse.mergedBlockId || null
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ —Å—Ç–∏—Ö–∞–º–∏
–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `/lib/verse-utils.ts` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- `formatVerseNumber()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä —Å—Ç–∏—Ö–∞ (1.16-18 –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö)
- `getVerseTitle()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∏—Ö–∞
- `isMergedVerse()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç–∏—Ö —á–∞—Å—Ç—å—é –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞
- `getMergedVerseNumbers()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –Ω–æ–º–µ—Ä–∞ —Å—Ç–∏—Ö–æ–≤ –≤ –±–ª–æ–∫–µ
- `isSameMergedBlock()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –ª–∏ —Å—Ç–∏—Ö–∏ –æ–¥–Ω–æ–º—É –±–ª–æ–∫—É

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
–û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- `/app/components/ReadingRoom.tsx`
- `/src/components/ReadingRoom.tsx`

–ó–∞–º–µ–Ω–µ–Ω–æ:
```typescript
`–°—Ç–∏—Ö ${sessionState.currentVerse.chapter}.${sessionState.currentVerse.verse}`
```

–ù–∞:
```typescript
getVerseTitle({
  chapter: sessionState.currentVerse.chapter,
  verse: sessionState.currentVerse.verse,
  isMergedVerse: sessionState.currentVerse.isMergedVerse,
  mergedWith: sessionState.currentVerse.mergedWith,
  mergedBlockId: sessionState.currentVerse.mergedBlockId
})
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_merged_verses_api.js` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API:
- ‚úÖ –°—Ç–∏—Ö 1.16 ‚Üí "1.16-18" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å [16, 17, 18])
- ‚úÖ –°—Ç–∏—Ö 1.17 ‚Üí "1.16-18" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å [16, 17, 18])
- ‚úÖ –°—Ç–∏—Ö 1.18 ‚Üí "1.16-18" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å [16, 17, 18])
- ‚úÖ –°—Ç–∏—Ö 1.21 ‚Üí "1.21-22" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å [21, 22])
- ‚úÖ –°—Ç–∏—Ö 1.22 ‚Üí "1.21-22" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å [21, 22])
- ‚úÖ –°—Ç–∏—Ö 1.32 ‚Üí "1.32-35" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å [32, 33, 34, 35])
- ‚úÖ –°—Ç–∏—Ö 1.35 ‚Üí "1.32-35" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å [32, 33, 34, 35])
- ‚úÖ –°—Ç–∏—Ö 1.1 ‚Üí "1.1" (–æ–¥–∏–Ω–æ—á–Ω—ã–π —Å—Ç–∏—Ö)
- ‚úÖ –°—Ç–∏—Ö 1.5 ‚Üí "1.5" (–æ–¥–∏–Ω–æ—á–Ω—ã–π —Å—Ç–∏—Ö)

**–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤: 100%**

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL:
```sql
SELECT chapter, "verseNumber", "isMergedVerse", "mergedWith", "mergedBlockId" 
FROM verses 
WHERE title = '–ë—Ö–∞–≥–∞–≤–∞–¥-–≥–∏—Ç–∞' AND chapter = 1 AND "verseNumber" IN (16, 17, 18);
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
 chapter | verseNumber | isMergedVerse |  mergedWith  |      mergedBlockId              
---------+-------------+---------------+--------------+-------------------------        
       1 |          16 | t             | [16, 17, 18] | merged_1_16_18_1a2be32e         
       1 |          17 | t             | [16, 17, 18] | merged_1_16_18_1a2be32e         
       1 |          18 | t             | [16, 17, 18] | merged_1_16_18_1a2be32e         
```

## –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –î–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –°—Ç–∏—Ö 1.16
- –°—Ç–∏—Ö 1.17  
- –°—Ç–∏—Ö 1.18
- –°—Ç–∏—Ö 1.21
- –°—Ç–∏—Ö 1.22

### –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –°—Ç–∏—Ö 1.16-18 (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –±–ª–æ–∫)
- –°—Ç–∏—Ö 1.21-22 (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –±–ª–æ–∫)
- –°—Ç–∏—Ö 1.1 (–æ–¥–∏–Ω–æ—á–Ω—ã–π —Å—Ç–∏—Ö)
- –°—Ç–∏—Ö 1.5 (–æ–¥–∏–Ω–æ—á–Ω—ã–π —Å—Ç–∏—Ö)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞:
```json
{
  "isMergedVerse": true,
  "mergedWith": [16, 17, 18],
  "mergedBlockId": "merged_1_16_18_1a2be32e"
}
```

### –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```typescript
function formatVerseNumber(verseData: VerseData): string {
  const { chapter, verse, isMergedVerse, mergedWith } = verseData;
  
  if (isMergedVerse && mergedWith && mergedWith.length > 1) {
    const minVerse = Math.min(...mergedWith);
    const maxVerse = Math.max(...mergedWith);
    
    if (minVerse === maxVerse) {
      return `${chapter}.${minVerse}`;
    } else {
      return `${chapter}.${minVerse}-${maxVerse}`;
    }
  }
  
  return `${chapter}.${verse}`;
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**

–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Å—Ç–∏—Ö–æ–≤ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "1.16-18" –∫–∞–∫ –±—ã–ª–æ –∑–∞–ø—Ä–æ—à–µ–Ω–æ. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã (–ø–∞—Ä—Å–µ—Ä, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, API, UI) –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ 30+ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∏—Ö–æ–≤ –∏–∑ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –≤ UI
- –°–æ–∑–¥–∞–Ω–∞ –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Ç–∏–ª–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ —Å—Ç–∏—Ö–∞–º–∏
- –û–±–µ—Å–ø–µ—á–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–¥–∏–Ω–æ—á–Ω—ã–º–∏ —Å—Ç–∏—Ö–∞–º–∏
- –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
