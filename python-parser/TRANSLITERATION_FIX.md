# Исправление извлечения транслитерации в Бхагавад Гите

## Проблема
Парсер Бхагавад Гиты не извлекал транслитерацию из vedabase.io. Поле `transliteration` было пустым во всех стихах.

## Причина
1. **Неправильный формат**: Транслитерация в vedabase.io написана кириллицей с диакритическими знаками, а не латиницей
2. **Неправильное регулярное выражение**: Парсер искал латинские символы с диакритиками
3. **Отсутствие комбинирующих диакритических знаков**: Регулярное выражение не учитывало Unicode комбинирующие символы

## Решение

### 1. Обновление регулярного выражения
```python
# Было (латиница):
transliteration_pattern = r'[a-zA-Zāīūṛṝḷḹēōṃḥṅñṭḍṇśṣ]+(?:\s+[a-zA-Zāīūṛṝḷḹēōṃḥṅñṭḍṇśṣ]+)*'

# Стало (кириллица с диакритиками):
transliteration_pattern = r'([а-яёāīūṛṝḷḹēōṃḥṅñṭḍṇśṣ\s\-\u0300-\u036F]+)'
```

### 2. Добавление комбинирующих диакритических знаков
- Добавлен диапазон `\u0300-\u036F` для комбинирующих диакритических знаков
- Это позволяет корректно обрабатывать символы типа `̣` (U+0323)

### 3. Улучшенная логика извлечения
- Поиск транслитерации после маркера "Текст стиха"
- Остановка на маркерах "Пословный перевод", "Перевод", "Комментарий"
- Проверка наличия диакритических знаков (включая комбинирующие)

### 4. Обновление проверки диакритических знаков
```python
has_diacritics = (re.search(r'[āīūṛṝḷḹēōṃḥṅñṭḍṇśṣ]', candidate, re.IGNORECASE) or 
                re.search(r'[\u0300-\u036F]', candidate))
```

## Результаты

### До исправления:
- Транслитерация: пустая во всех стихах
- Стихи с транслитерацией: 0/35

### После исправления:
- **Глава 1**: 31/35 стихов с транслитерацией ✅
- **Глава 2**: 69/69 стихов с транслитерацией ✅
- **Глава 3**: 42/42 стиха с транслитерацией ✅

### Пример извлеченной транслитерации:
```
дхр̣тара̄шт̣ра ува̄чадхарма-кшетре куру-кшетресамавета̄ йуйутсавах̣ма̄мака̄х̣ па̄н̣д̣ава̄ш́ чаиваким акурвата сан̃джайа
```

## Тестирование
```bash
python test_parser.py
```

Все тесты проходят успешно. Транслитерация корректно извлекается и сохраняется в базу данных.

## Файлы изменены
- `bhagavad_gita_parser.py` - обновлена логика извлечения транслитерации
- `database.py` - добавлен метод `get_verses_by_chapter()`

## Статус
✅ **ИСПРАВЛЕНО** - Транслитерация теперь корректно извлекается из всех стихов Бхагавад Гиты и сохраняется в базу данных.
